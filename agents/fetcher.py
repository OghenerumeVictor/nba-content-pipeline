# agents/fetcher.py

# Placeholder or autogenerated content for agents/fetcher.py

from nba_api.live.nba.endpoints import scoreboard, boxscore
import time

def fetch_nba_data():
    try:
        games = scoreboard.ScoreBoard().get_dict()["scoreboard"]["games"]
        completed = [g for g in games if g["gameStatus"] == 3]
        if not completed:
            return {}

        game_id = completed[0]["gameId"]
        time.sleep(1)  # avoid hitting rate limits
        full_data = boxscore.BoxScore(game_id=game_id).get_dict()
        game = full_data.get("game", {})

        # inject player data into team objects for consistency
        home_players = full_data.get("homeTeam", {}).get("players", [])
        away_players = full_data.get("awayTeam", {}).get("players", [])
        game["homeTeam"]["players"] = home_players
        game["awayTeam"]["players"] = away_players
        return game

    except Exception as e:
        print("Error fetching NBA data:", e)
        return {}
